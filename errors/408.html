<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>408 - Request Timeout</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/404.css">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <style>

        .not-found-image {
            filter: invert(0); /* Keep it black like the 404 page */
            width: 150px; /* Adjust size for logo */
        }
        .ping-stats {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #888;
        }
        .refresh-timer {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #aaa;
        }
        .status-link {
            color: #f48120; /* Cloudflare Orange */
            text-decoration: none;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="../assets/timer.png" alt="408 Request Timeout" class="not-found-image">
        <h1>408</h1>
        <p>Request Timeout</p>
        <a href="../index.html" class="home-link">Go back to Home</a>

        <div class="funny-section">
            <p class="error-code">Error Code: 408</p>
            <p id="funny-text" class="funny-text"></p>
            <div id="ping-stats" class="ping-stats">
                Checking connection...
                <a href="https://www.cloudflarestatus.com/" target="_blank" class="status-link">Check Cloudflare Status</a>
            </div>
            <div id="refresh-timer" class="refresh-timer">Checking connection in 10 seconds...</div>
        </div>
    </div>

    <script>
        const funnyTexts = [
            "Wahh Wahh. I'm a kid I want the site NOW!",
            "Fuck this...",
            "YOU'RE TAKING TOO LONG...",
            "YOUR TOO TOO",
            "Bud you took too long. check your damn ping bud."
        ]

        const funnyTextElement = document.getElementById('funny-text');
        const randomIndex = Math.floor(Math.random() * funnyTexts.length);
        funnyTextElement.innerHTML = funnyTexts[randomIndex];

        // Ping Check
        const pingStats = document.getElementById('ping-stats');
        const timerElement = document.getElementById('refresh-timer');
        let timeLeft = 10;
        let countdownInterval;

        const checkPing = async () => {
            const start = Date.now();
            // Preserve the link when updating text
            const linkHTML = ` <a href="https://www.cloudflarestatus.com/" target="_blank" class="status-link">Check Cloudflare Status</a>`;

            try {
                // Fetch favicon to test latency. Adding timestamp to avoid cache.
                await fetch('../assets/favicon.ico?' + new Date().getTime());
                const end = Date.now();
                const latency = end - start;
                pingStats.innerHTML = `Server Latency: <b>${latency}ms</b>` + linkHTML;
            } catch (e) {
                pingStats.innerHTML = `Server Latency: <b>Timeout</b> (Check your connection)` + linkHTML;
            }

            // Reset timer
            timeLeft = 10;
            startTimer();
        };

        const startTimer = () => {
            clearInterval(countdownInterval);
            timerElement.textContent = `Checking connection in ${timeLeft} seconds...`;

            countdownInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = `Checking connection in ${timeLeft} seconds...`;

                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    timerElement.textContent = "Checking...";
                    checkPing();
                }
            }, 1000);
        };

        // Initial check
        setTimeout(checkPing, 500);
    </script>
</body>
</html>