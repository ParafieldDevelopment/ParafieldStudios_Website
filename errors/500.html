<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>500 - Internal Server Error</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/404.css">
    <link rel="icon" type="image/x-icon" href="../assets/favicon.ico">
    <style>
        /* Specific override for 500 page logo if needed */
        .not-found-image {
            filter: invert(0); /* Keep it black like the 404 page */
            width: 150px; /* Adjust size for logo */
        }
        .ping-stats {
            margin-top: 20px;
            font-size: 0.9rem;
            color: #888;
        }
        .refresh-timer {
            margin-top: 5px;
            font-size: 0.8rem;
            color: #aaa;
        }
        .status-link {
            color: #f48120; /* Cloudflare Orange */
            text-decoration: none;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-link:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <img src="../assets/fire-57.svg" alt="500 Server Error" class="not-found-image">
        <h1>500</h1>
        <p>Internal Server Error. Something went wrong on our end.</p>
        <a href="../index.html" class="home-link">Go back to Home</a>

        <div class="funny-section">
            <p class="error-code">Error Code: 500</p>
            <p id="funny-text" class="funny-text"></p>
            <div id="ping-stats" class="ping-stats">
                Checking connection...
                <a href="https://www.cloudflarestatus.com/" target="_blank" class="status-link">Check Cloudflare Status</a>
            </div>
            <div id="refresh-timer" class="refresh-timer">Checking connection in 10 seconds...</div>
        </div>
    </div>

    <script>
        const funnyTexts = [
            "Our servers are having a bad day.",
            "We spilled coffee on the mainframe.",
            "The hamsters running the server took a break.",
            "It's not you, it's us. Literally.",
            "\"Have you tried turning it off and on again?\" SHUT UP WE'RE TRYING THAT!",
            "Cloudflare you motherfuckers...",
            "Us or Cloudflare's fault. We can agree that we suck at server management.",
            "Sorry I was using Cloudflare servers as target practice-",
            "What? You expected me to say something?",
            "such poor creature, torturing such innocent servers"
        ]

        const funnyTextElement = document.getElementById('funny-text');
        const randomIndex = Math.floor(Math.random() * funnyTexts.length);
        funnyTextElement.innerHTML = funnyTexts[randomIndex];

        // Ping Check
        const pingStats = document.getElementById('ping-stats');
        const timerElement = document.getElementById('refresh-timer');
        let timeLeft = 10;
        let countdownInterval;

        const checkPing = async () => {
            const start = Date.now();
            // Preserve the link when updating text
            const linkHTML = ` <a href="https://www.cloudflarestatus.com/" target="_blank" class="status-link">Check Cloudflare Status</a>`;

            try {
                // Fetch favicon to test latency. Adding timestamp to avoid cache.
                await fetch('../assets/favicon.ico?' + new Date().getTime());
                const end = Date.now();
                const latency = end - start;
                pingStats.innerHTML = `Server Latency: <b>${latency}ms</b>` + linkHTML;
            } catch (e) {
                pingStats.innerHTML = `Server Latency: <b>Timeout</b> (Check your connection)` + linkHTML;
            }

            // Reset timer
            timeLeft = 10;
            startTimer();
        };

        const startTimer = () => {
            clearInterval(countdownInterval);
            timerElement.textContent = `Checking connection in ${timeLeft} seconds...`;

            countdownInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = `Checking connection in ${timeLeft} seconds...`;

                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    timerElement.textContent = "Checking...";
                    checkPing();
                }
            }, 1000);
        };

        // Initial check
        setTimeout(checkPing, 500);
    </script>
</body>
</html>